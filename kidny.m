

  % ????? ?????? ???????? ??? ???? ??????
A = imread('klkl.jpg');
grayImage = rgb2gray(A);

% ????? ?????? ??? ?????? ????? ???????? ?????? ???????? ?????
antData = zeros(size(grayImage), 'double');
antData(grayImage < 128) = 0.5; % ????? ???? 0.5 ?????? ????? ??????

% ??????? ????? bwlabel ?????? ??????? ??????? ???????
labeledImage = bwlabel(antData == 0.5);

% ???? ???????? ??????? ??????? ???????
stats = regionprops(labeledImage);

% ????? ??????? ??? ??????? ???? ??????
[~, sortedIdx] = sort([stats.Area], 'descend');
stats = stats(sortedIdx);

% ????? ??????? ???????? ??? ??????
numAreas = numel(stats);
resultImage = A; % ?????? ??????? ?????? ??????? ?? ??????? ????????
for i = 1:numAreas
    % ?? ???????
    areaText = sprintf('%d', i);
    
    % ???? ???????
    centroid = stats(i).Centroid;
    xPos = round(centroid(1)) - 10;
    yPos = round(centroid(2)) - 10;
    
    % ????? ?? ??????? ??? ?????? ???? ????
    resultImage = insertText(resultImage, [xPos, yPos], areaText, 'FontSize', 14, 'TextColor', 'red', 'BoxOpacity', 0);
end

% ??? ?????? ?? ??????? ???????? ???????? ?????
figure;
imshow(resultImage);
title('?????? ?? ??????? ???????? ???????? ?????');

% ??? ????? ????? ?? ??? ???????
disp('?????? ??????? ???????:');
for i = 1:numAreas
    fprintf('??????? ??? %d: %d\n', i, stats(i).Area);
end
